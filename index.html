<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UPI QR Extractor Pro</title>

<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>
:root {
  --primary: #6C63FF;
  --secondary: #4CAF50;
  --danger: #ff5252;
  --bg: #0f172a;
  --card: rgba(255,255,255,0.05);
  --glass: rgba(255,255,255,0.08);
  --text: #ffffff;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, #0f172a, #1e293b);
  color: var(--text);
  display: flex;
  justify-content: center;
  padding: 20px;
}

.container {
  width: 100%;
  max-width: 900px;
}

h1 {
  text-align: center;
  margin-bottom: 10px;
  font-weight: 600;
}

.tabs {
  display: flex;
  justify-content: center;
  margin: 20px 0;
  gap: 10px;
  flex-wrap: wrap;
}

.tab-btn {
  padding: 10px 20px;
  border-radius: 30px;
  border: none;
  cursor: pointer;
  background: var(--glass);
  color: white;
  transition: 0.3s;
}

.tab-btn.active {
  background: var(--primary);
}

.card {
  background: var(--card);
  backdrop-filter: blur(12px);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

input {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border-radius: 10px;
  border: none;
  background: rgba(255,255,255,0.1);
  color: white;
}

button {
  padding: 12px 18px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 500;
  transition: 0.3s;
}

.btn-primary { background: var(--primary); color: white; }
.btn-success { background: var(--secondary); color: white; }
.btn-danger { background: var(--danger); color: white; }

button:hover { opacity: 0.8; }

#reader { width: 100%; }

#generatedQR canvas {
  margin-top: 15px;
  border-radius: 12px;
}

.message {
  padding: 10px;
  border-radius: 8px;
  margin-top: 10px;
  display: none;
}

.success { background: rgba(76,175,80,0.2); }
.error { background: rgba(255,82,82,0.2); }

@media (max-width: 600px) {
  .tabs { flex-direction: column; }
}
</style>
</head>
<body>

<div class="container">
<h1>UPI QR Extractor Pro</h1>

<div class="tabs">
  <button class="tab-btn active" onclick="switchTab('scan')">Scan</button>
  <button class="tab-btn" onclick="switchTab('upload')">Upload</button>
  <button class="tab-btn" onclick="switchTab('generate')">Generate</button>
</div>

<!-- Scan -->
<div id="scan" class="card tab-content">
  <div id="reader"></div>
</div>

<!-- Upload -->
<div id="upload" class="card tab-content" style="display:none;">
  <input type="file" id="qrFile" accept="image/*">
</div>

<!-- Generate -->
<div id="generate" class="card tab-content" style="display:none;">
  <input type="text" id="newUpiId" placeholder="UPI ID">
  <input type="text" id="newName" placeholder="Name">
  <input type="number" id="newAmount" placeholder="Amount">
  <button class="btn-primary" onclick="generateQR()">Generate QR</button>
  <div id="generatedQR"></div>
</div>

<!-- Extracted -->
<div class="card">
  <h3>Extracted Details</h3>
  <input type="text" id="upiId" placeholder="UPI ID" readonly>
  <input type="text" id="merchantName" placeholder="Merchant Name" readonly>
  <input type="text" id="amount" placeholder="Amount" readonly>
  <button class="btn-primary" onclick="copyUPI()">Copy UPI</button>
  <button class="btn-success" onclick="openUPI()">Pay Now</button>
  <div id="msg" class="message"></div>
</div>

</div>

<script>

// Tabs
function switchTab(tab) {
  document.querySelectorAll('.tab-content').forEach(el => el.style.display='none');
  document.getElementById(tab).style.display='block';
  document.querySelectorAll('.tab-btn').forEach(btn=>btn.classList.remove('active'));
  event.target.classList.add('active');
}

// Message
function showMessage(text, type) {
  const msg = document.getElementById("msg");
  msg.innerText = text;
  msg.className = "message " + type;
  msg.style.display = "block";
  setTimeout(()=>msg.style.display="none",3000);
}

// Extract
function extractUPI(text) {
  if (!text.startsWith("upi://pay")) {
    showMessage("Invalid UPI QR", "error");
    return;
  }

  const url = new URL(text);
  document.getElementById("upiId").value = url.searchParams.get("pa") || "";
  document.getElementById("merchantName").value = url.searchParams.get("pn") || "";
  document.getElementById("amount").value = url.searchParams.get("am") || "Not Fixed";

  showMessage("UPI QR Extracted Successfully", "success");
}

// Scanner
let scanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
scanner.render(decodedText => extractUPI(decodedText));

// Upload
document.getElementById("qrFile").addEventListener("change", function(e) {
  const file = e.target.files[0];
  const html5QrCode = new Html5Qrcode("reader");
  html5QrCode.scanFile(file, true)
    .then(decodedText => extractUPI(decodedText))
    .catch(() => showMessage("Cannot read QR", "error"));
});

// Copy
function copyUPI() {
  const input = document.getElementById("upiId");
  input.select();
  document.execCommand("copy");
  showMessage("UPI Copied!", "success");
}

// Open UPI
function openUPI() {
  const pa = document.getElementById("upiId").value;
  const pn = document.getElementById("merchantName").value;
  const am = document.getElementById("amount").value;

  if (!pa) {
    showMessage("No UPI ID Found", "error");
    return;
  }

  let link = `upi://pay?pa=${pa}&pn=${pn}&cu=INR`;
  if (am && am !== "Not Fixed") link += `&am=${am}`;

  window.location.href = link;
}

// Generate
function generateQR() {
  const pa = document.getElementById("newUpiId").value;
  const pn = document.getElementById("newName").value;
  const am = document.getElementById("newAmount").value;

  if (!pa) {
    showMessage("Enter UPI ID", "error");
    return;
  }

  let upiString = `upi://pay?pa=${pa}&pn=${pn}&cu=INR`;
  if (am) upiString += `&am=${am}`;

  document.getElementById("generatedQR").innerHTML = "";

  QRCode.toCanvas(upiString, { width: 220 }, function (err, canvas) {
    document.getElementById("generatedQR").appendChild(canvas);
  });

  showMessage("QR Generated!", "success");
}

</script>

</body>
</html>
